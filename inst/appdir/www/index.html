<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="keywords" content="jquery,ui,easy,easyui,web">
	<meta name="description" content="easyui help you build your web page easily!">
	<title>Lazy loading nodes in TreeGrid - jQuery EasyUI Demo</title>
	<link rel="stylesheet" type="text/css" href="themes/default/easyui.css">
	<link rel="stylesheet" type="text/css" href="themes/icon.css">
	<link rel="stylesheet" type="text/css" href="styles/demo.css">
    <!-- <script src="shared/jquery.js" type="text/javascript"></script> -->
    <script src="jquery.min.js"></script>

	<script type="text/javascript" src="js/jquery.easyui.min.js"></script>
    <script src="js/jquery.easytabs.min.js" type="text/javascript"></script>
  <script src="shared/shiny.js" type="text/javascript"></script>
  <link rel="stylesheet" type="text/css" href="shared/shiny.css"/> 
  <script>
$(document).ready(function() {
count = 0;
$(document).on('click', 'span', function () {
        
    });  
$('#test').treegrid({
	onClickCell: function(field,row){
        tempRow = row.id;
        path = row.name; 
        for(i=0; i<row.id.length-1; i++){
            parentRow = $('#test').treegrid('getParent', tempRow);
            path += ',' + parentRow.name;
            tempRow = parentRow.id
        }
        Shiny.unbindAll();
        $("#fcnName").val(path);
        Shiny.bindAll();
	}
});

setTimeout(
    function() {
    $('#test').treegrid('collapseAll');
      //$('#hotp').slideToggle("slow");
    }, 1000);
$('#hotpaths').treegrid({
	onClickCell: function(field,row){
        tempRow = row.id;
        path = row.name; 
        for(i=0; i<row.id.length-1; i++){
            parentRow = $('#hotpaths').treegrid('getParent', tempRow);
            path += ',' + parentRow.name;
            tempRow = parentRow.id
        }
        Shiny.unbindAll();
        $("#fcnName").val(path);
        Shiny.bindAll();
	}
});
$('#tab-container').easytabs();
$('#tab-container').bind('easytabs:after', function(evt, tab, panel, data) {
    if(panel.selector == '#tabs1-hotpaths' && count == 0){
           $('#hotpaths').treegrid({
        onClickCell: function(field,row){
            tempRow = row.id;
            path = row.name; 
            for(i=0; i<row.id.length-1; i++){
                parentRow = $('#hotpaths').treegrid('getParent', tempRow);
                path += ',' + parentRow.name;
                tempRow = parentRow.id
            }
            Shiny.unbindAll();
            $("#fcnName").val(path);
            Shiny.bindAll();
        }
    });
    setTimeout(
    function() {
    $('#hotpaths').treegrid('collapseAll');
    }, 1000);
    count++;
    }
});
});
  </script>
  <style>
  #fileName{font-weight: bold; position: absolute; top:480px; left:10px;}
  .red{color:red}
  .hidden{display:none}
  
  .etabs { margin: 0; padding: 0; }
.tab { display: inline-block; zoom:1; *display:inline; background: #eee; border: solid 1px #999; border-bottom: none; -moz-border-radius: 4px 4px 0 0; -webkit-border-radius: 4px 4px 0 0; }
.tab a { font-size: 14px; line-height: 2em; display: block; padding: 0 10px; outline: none; }
.tab a:hover { text-decoration: underline; }
.tab.active { background: #fff; padding-top: 6px; position: relative; top: 1px; border-color: #666; }
.tab a.active { font-weight: bold; }
.tab-container .panel-container { background: #fff; border: solid #666 1px; padding: 10px; -moz-border-radius: 0 4px 4px 4px; -webkit-border-radius: 0 4px 4px 4px; }
  </style>
</head>
<body>
<div id="tab-container" class="tab-container">
  <ul class='etabs'>
    <li class='tab'><a href="#tabs1-funsum">Function Summary</a></li>
    <li class='tab'><a href="#tabs1-hotpaths">Hot Paths</a></li>
  </ul>
	
	<div class="demo-info" style="margin-bottom:10px">
		<div class="demo-tip icon-tip">&nbsp;</div>
		<div></div>
	</div>
    <input type="text" id="fcnName" name="fcnName" value="" class="hidden"/>

    <div id="tabs1-funsum">
    <div id="funSum" style="float:left;width:800px;height:400px">
	<table id="test" title="Function Summary" class="easyui-treegrid" style="float:left;width:800px;height:400px" 
    data-options="
                url: 'test.JSON',
				method: 'get',
				rownumbers: true,
				idField: 'id',
				treeField: 'name'
			">
		<thead>
<tr>
<th field="name" width="220">Name</th>
<th field="total" width="150">Total</th>
<th field="self" width="150">Self</th>
<th field="GC" width="150">GC</th>
<th field="GCself" width="150">GC.Self</th>
</tr>
		</thead>
	</table>
    </div>
    </div>
    <div id="tabs1-hotpaths">
    <div id="hotp" style="float:left;width:800px;height:400px">
	<table id="hotpaths" title="Hot Paths" class="easyui-treegrid" style="float:left;width:800px;height:400px" 
			data-options="
				url: 'hotpaths.JSON',
				method: 'get',
				rownumbers: true,
				idField: 'id',
				treeField: 'name',
				loadFilter: myLoadFilter
			">
		<thead>
<tr>
<th field="name" width="220">Name</th>
<th field="total" width="150">Total</th>
<th field="self" width="150">Self</th>
<th field="GC" width="150">GC</th>
<th field="GCself" width="150">GC.Self</th>
</tr>
		</thead>
	</table>
    </div>
    </div>
    </div>
     <div id="plot" class="shiny-plot-output" style="float:right;width: 32%; height: 400px"></div> 
     
	<script>
		function myLoadFilter(data,parentId){
			function setData(){
				var todo = [];
				for(var i=0; i<data.length; i++){
					todo.push(data[i]);
				}
				while(todo.length){
					var node = todo.shift();
					if (node.children){
						node.state = 'closed';
						node.children1 = node.children;
						node.children = undefined;
						todo = todo.concat(node.children1);
					}
				}
			}
			
			setData(data);
			var tg = $(this);
			var opts = tg.treegrid('options');
			opts.onBeforeExpand = function(row){
				if (row.children1){
					tg.treegrid('append',{
						parent: row[opts.idField],
						data: row.children1
					});
					row.children1 = undefined;
					tg.treegrid('expand', row[opts.idField]);
				}
				return row.children1 == undefined;
			};
			return data;
		}
	</script>
    <p style="clear:both"></p>
     <pre id="fcnAnnot" class="shiny-html-output" style="border: 1px double silver;height: 400px; margin-top: 30px;overflow-y:scroll;"></pre>
    <pre id="test2"></pre>

</body>
</html>
